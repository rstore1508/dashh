<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard de Vendas - Ranking de Produtos</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
  }
  .login-screen {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .login-container {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 40px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 16px 48px rgba(0,0,0,0.2);
    text-align: center;
  }
  .login-title {
    font-size: 2rem;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 30px;
  }
  .login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .login-input {
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
  }
  .login-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
  }
  .login-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .login-btn:hover {
    transform: translateY(-2px);
  }
  .login-error {
    color: #e74c3c;
    margin-top: 10px;
    display: none;
  }
  .main-dashboard {
    display: none;
  }
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }
  .header {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    position: relative;
  }
  .logout-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: #e74c3c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }
  .logout-btn:hover {
    background: #c0392b;
  }
  .header h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-align: center;
    margin-bottom: 20px;
  }
  .controls {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
    align-items: center;
  }
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .filter-group label {
    font-weight: 600;
    color: #555;
  }
  select, input {
    padding: 12px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 16px;
    background: white;
    transition: all 0.3s ease;
  }
  select:focus, input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
  }
  .add-product-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: transform 0.2s ease;
  }
  .add-product-btn:hover {
    transform: translateY(-2px);
  }
  .stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  .stat-card {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
  }
  .stat-card:hover {
    transform: translateY(-5px);
  }
  .stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .stat-label {
    color: #666;
    font-size: 1rem;
    margin-top: 8px;
  }
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(380px,1fr));
    gap: 25px;
  }
  .product-card {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }
  .product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 16px 48px rgba(0,0,0,0.15);
  }
  .ranking-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
  }
  .ranking-badge.top-3 {
    background: linear-gradient(135deg, #f1c40f, #f39c12);
  }
  .ranking-badge.top-1 {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
  }
  .product-image {
    width: 120px;
    height: 120px;
    border-radius: 16px;
    object-fit: cover;
    margin: 0 auto 20px;
    display: block;
    border: 3px solid #f0f0f0;
    transition: all 0.3s ease;
  }
  .product-card:hover .product-image {
    transform: scale(1.05);
  }
  .product-name {
    font-size: 1.3rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
    text-align: center;
  }
  .product-sku {
    font-size: 0.85rem;
    color: #777;
    text-align: center;
    margin-bottom: 12px;
    font-style: italic;
  }
  .product-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
  }
  .stat-item {
    text-align: center;
    padding: 12px;
    background: rgba(102,126,234,0.1);
    border-radius: 12px;
  }
  .stat-value {
    font-size: 1.4rem;
    font-weight: bold;
    color: #667eea;
  }
  .stat-text {
    font-size: 0.9rem;
    color: #666;
    margin-top: 4px;
  }
  .stock-section {
    margin: 20px 0;
    padding: 15px;
    background: rgba(46,204,113,0.1);
    border-radius: 12px;
  }
  .stock-title {
    font-weight: bold;
    color: #27ae60;
    margin-bottom: 10px;
    text-align: center;
  }
  .stock-grid {
    display: grid;
    grid-template-columns: repeat(3,1fr);
    gap: 10px;
  }
  .stock-item {
    text-align: center;
    padding: 8px;
    background: white;
    border-radius: 8px;
    border: 2px solid #27ae60;
  }
  .stock-location {
    font-size: 0.8rem;
    font-weight: bold;
    color: #27ae60;
  }
  .stock-quantity {
    font-size: 1.2rem;
    font-weight: bold;
    color: #2c3e50;
  }
  .low-stock {
    border-color: #e74c3c;
  }
  .low-stock .stock-location {
    color: #e74c3c;
  }
  .channels-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
  }
  .channel-tag {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
  }
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(5px);
    z-index: 1000;
  }
  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 20px;
    padding: 30px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
  }
  .modal-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
  }
  .close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #555;
  }
  .form-group input,
  .form-group select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 2px solid #ccc;
    transition: border-color 0.3s ease;
  }
  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: #667eea;
  }
  .form-row {
    display: grid;
    grid-template-columns: repeat(3,1fr);
    gap: 15px;
  }
  .save-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    width: 100%;
    transition: transform 0.2s ease;
  }
  .save-btn:hover {
    transform: translateY(-2px);
  }
  .cancel-btn {
    margin-top: 10px;
    background: #999;
    padding: 10px;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    width: 100%;
    font-size: 16px;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  .cancel-btn:hover {
    background: #666;
  }
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }
  .empty-state h3 {
    margin-bottom: 15px;
    font-size: 1.5rem;
  }
  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    .header h1 {
      font-size: 2rem;
    }
    .controls {
      flex-direction: column;
      align-items: stretch;
    }
    .products-grid {
      grid-template-columns: 1fr;
    }
    .form-row {
      grid-template-columns: 1fr;
    }
    .stock-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <!-- Tela de Login -->
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <h1 class="login-title">🔐 Acesso Restrito</h1>
      <form id="loginForm" class="login-form" autocomplete="off">
        <input
          type="text"
          id="username"
          class="login-input"
          placeholder="Usuário"
          required
          autocomplete="username"
          autofocus
        />
        <input
          type="password"
          id="password"
          class="login-input"
          placeholder="Senha"
          required
          autocomplete="current-password"
        />
        <button type="submit" class="login-btn">Entrar</button>
        <div id="loginError" class="login-error">Usuário ou senha incorretos!</div>
      </form>
    </div>
  </div>

  <!-- Dashboard Principal -->
  <div id="mainDashboard" class="main-dashboard" aria-hidden="true">
    <div class="container">
      <div class="header">
        <button class="logout-btn" onclick="logout()" aria-label="Sair do Dashboard">Sair</button>
        <h1>Ranking de Produtos - Dashboard</h1>
        <div class="controls">
          <div class="filter-group">
            <label for="skuFilter">Filtrar por SKU:</label>
            <input type="text" id="skuFilter" placeholder="Digite o código SKU" />
          </div>
          <div class="filter-group">
            <label for="monthFilter">Filtrar por Mês:</label>
            <select id="monthFilter" aria-label="Filtro por mês">
              <option value="">Todos os Meses</option>
              <option value="janeiro">Janeiro</option>
              <option value="fevereiro">Fevereiro</option>
              <option value="março">Março</option>
              <option value="abril">Abril</option>
              <option value="maio">Maio</option>
              <option value="junho">Junho</option>
              <option value="julho">Julho</option>
              <option value="agosto">Agosto</option>
              <option value="setembro">Setembro</option>
              <option value="outubro">Outubro</option>
              <option value="novembro">Novembro</option>
              <option value="dezembro">Dezembro</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="channelFilter">Filtrar por Canal:</label>
            <select id="channelFilter" aria-label="Filtro por canal">
              <option value="">Todos os Canais</option>
              <option value="shecom ml">Shecom ML</option>
              <option value="tuguir ml">Tuguir ML</option>
              <option value="romplac">Romplac</option>
              <option value="dafiti">Dafiti</option>
              <option value="shopee">Shopee</option>
              <option value="magazine luiza">Magazine Luiza</option>
              <option value="relogiostore">RelogioStore</option>
              <option value="shop do relogio">Shop do Relogio</option>
              <option value="netshoes">Netshoes</option>
            </select>
          </div>
          <button class="add-product-btn" onclick="openModal()" type="button">+ Adicionar Produto</button>
        </div>
      </div>
      <div class="stats-overview">
        <div class="stat-card">
          <div class="stat-number" id="totalProducts">0</div>
          <div class="stat-label">Total de Produtos</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalSales">R$ 0,00</div>
          <div class="stat-label">Vendas Totais</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalUnits">0</div>
          <div class="stat-label">Unidades Vendidas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalStock">0</div>
          <div class="stat-label">Estoque Total</div>
        </div>
      </div>
      <div id="productsContainer" class="products-grid" aria-live="polite" aria-atomic="true"></div>
    </div>
  </div>

  <!-- Modal adicionar/editar produto -->
  <div id="productModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Adicionar Produto</h2>
        <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
      </div>
      <form id="productForm" autocomplete="off">
        <div class="form-group">
          <label for="productSKU">Código (SKU):</label>
          <input type="text" id="productSKU" required placeholder="Ex: PROD12345" />
        </div>
        <div class="form-group">
          <label for="productName">Nome do Produto:</label>
          <input type="text" id="productName" required />
        </div>
        <div class="form-group">
          <label for="productImage">URL da Imagem:</label>
          <input
            type="url"
            id="productImage"
            placeholder="https://exemplo.com/imagem.jpg"
            pattern="https?://.+"
            title="Insira uma URL válida começando com http:// ou https://"
          />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="productMonth">Mês:</label>
            <select id="productMonth" required>
              <option value="janeiro">Janeiro</option>
              <option value="fevereiro">Fevereiro</option>
              <option value="março">Março</option>
              <option value="abril">Abril</option>
              <option value="maio">Maio</option>
              <option value="junho">Junho</option>
              <option value="julho">Julho</option>
              <option value="agosto">Agosto</option>
              <option value="setembro">Setembro</option>
              <option value="outubro">Outubro</option>
              <option value="novembro">Novembro</option>
              <option value="dezembro">Dezembro</option>
            </select>
          </div>
          <div class="form-group">
            <label for="productUnits">Unidades Vendidas:</label>
            <input type="number" id="productUnits" min="0" required />
          </div>
          <div class="form-group">
            <label for="productRevenue">Faturamento (R$):</label>
            <input type="number" id="productRevenue" min="0" step="0.01" required />
          </div>
        </div>
        <div class="form-group">
          <label for="productChannel">Canal de Venda:</label>
          <select id="productChannel" required>
            <option value="shecom ml">Shecom ML</option>
            <option value="tuguir ml">Tuguir ML</option>
            <option value="romplac">Romplac</option>
            <option value="dafiti">Dafiti</option>
            <option value="shopee">Shopee</option>
            <option value="magazine luiza">Magazine Luiza</option>
            <option value="relogiostore">RelogioStore</option>
            <option value="shop do relogio">Shop do Relogio</option>
            <option value="netshoes">Netshoes</option>
          </select>
        </div>
        <div class="form-group">
          <label>Estoque por Localização:</label>
          <div class="form-row">
            <div class="form-group">
              <label for="stockFull">Full (unidades):</label>
              <input type="number" id="stockFull" min="0" value="0" required />
            </div>
            <div class="form-group">
              <label for="stockSP">SP (unidades):</label>
              <input type="number" id="stockSP" min="0" value="0" required />
            </div>
            <div class="form-group">
              <label for="stockMASP">MA/SP (unidades):</label>
              <input type="number" id="stockMASP" min="0" value="0" required />
            </div>
          </div>
        </div>
        <button type="submit" class="save-btn">Salvar Produto</button>
        <button type="button" class="cancel-btn" onclick="cancelEdit()">Cancelar</button>
      </form>
    </div>
  </div>

<script>
  const validCredentials = {
    admin: "vendas123",
  };

  let products = [];
  let editingProductId = null;

  function loadData() {
    const data = localStorage.getItem("productsData");
    if (data) {
      try {
        products = JSON.parse(data);
      } catch {
        products = [];
      }
    }
  }

  function saveData() {
    localStorage.setItem("productsData", JSON.stringify(products));
  }

  function renderProducts() {
    const container = document.getElementById("productsContainer");
    const skuFilter = document.getElementById("skuFilter").value.trim().toLowerCase();
    const monthFilter = document.getElementById("monthFilter").value.toLowerCase();
    const channelFilter = document.getElementById("channelFilter").value.toLowerCase();

    let filtered = products;

    if (skuFilter) {
      filtered = filtered.filter(p => p.sku.toLowerCase().includes(skuFilter));
    }
    if (monthFilter) filtered = filtered.filter(p => p.month.toLowerCase() === monthFilter);
    if (channelFilter) filtered = filtered.filter(p => p.channel.toLowerCase() === channelFilter);

    if (filtered.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <h3>Nenhum produto encontrado</h3>
          <p>Tente ajustar os filtros ou adicione novos produtos</p>
        </div>
      `;
      updateStats(filtered);
      return;
    }

    filtered.sort((a,b) => b.units - a.units);

    container.innerHTML = filtered.map((p, i) => {
      const rank = i + 1;
      const totalStock = p.stock.full + p.stock.sp + p.stock.masp;
      const lowStock = totalStock < 20;
      let rankClass = "";
      if (rank === 1) rankClass = "top-1";
      else if (rank <= 3) rankClass = "top-3";

      return `
        <div class="product-card" tabindex="0" role="button" aria-pressed="false" onclick="openModalById(${p.id})" onkeypress="if(event.key==='Enter'){openModalById(${p.id})}">
          <div class="ranking-badge ${rankClass}">${rank}º</div>
          <img src="${p.image || 'https://via.placeholder.com/120x120?text=Produto'}"
            alt="${p.name}" class="product-image"
            onerror="this.src='https://via.placeholder.com/120x120?text=Produto'"/>
          <div class="product-sku">SKU: ${p.sku}</div>
          <h3 class="product-name">${p.name}</h3>
          <div class="product-stats">
            <div class="stat-item">
              <div class="stat-value">${p.units}</div>
              <div class="stat-text">Unidades Vendidas</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">R$ ${p.revenue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
              <div class="stat-text">Faturamento</div>
            </div>
          </div>
          <div class="stock-section">
            <div class="stock-title">📦 Controle de Estoque</div>
            <div class="stock-grid">
              <div class="stock-item ${p.stock.full < 10 ? 'low-stock' : ''}">
                <div class="stock-location">FULL</div>
                <div class="stock-quantity">${p.stock.full}</div>
              </div>
              <div class="stock-item ${p.stock.sp < 10 ? 'low-stock' : ''}">
                <div class="stock-location">SP</div>
                <div class="stock-quantity">${p.stock.sp}</div>
              </div>
              <div class="stock-item ${p.stock.masp < 10 ? 'low-stock' : ''}">
                <div class="stock-location">MA/SP</div>
                <div class="stock-quantity">${p.stock.masp}</div>
              </div>
            </div>
          </div>
          <div class="channels-list">
            <span class="channel-tag">${p.channel}</span>
            <span class="channel-tag">${p.month}</span>
            ${lowStock ? `<span class="channel-tag" style="background:#e74c3c">⚠ Estoque Baixo</span>` : ''}
          </div>
        </div>
      `;
    }).join("");

    updateStats(filtered);
  }

  function openModal(product = null) {
    const modal = document.getElementById("productModal");
    modal.style.display = "block";
    modal.setAttribute("aria-hidden", "false");

    if (product) {
      editingProductId = product.id;
      document.getElementById("productSKU").value = product.sku;
      document.getElementById("productName").value = product.name;
      document.getElementById("productImage").value = product.image;
      document.getElementById("productMonth").value = product.month;
      document.getElementById("productChannel").value = product.channel;
      document.getElementById("productUnits").value = product.units;
      document.getElementById("productRevenue").value = product.revenue;
      document.getElementById("stockFull").value = product.stock.full;
      document.getElementById("stockSP").value = product.stock.sp;
      document.getElementById("stockMASP").value = product.stock.masp;
    } else {
      editingProductId = null;
      document.getElementById("productForm").reset();
    }

    document.getElementById("productSKU").focus();
  }

  function closeModal() {
    const modal = document.getElementById("productModal");
    modal.style.display = "none";
    modal.setAttribute("aria-hidden", "true");
    document.getElementById("productForm").reset();
    editingProductId = null;
  }

  function cancelEdit() {
    closeModal();
  }

  function openModalById(id) {
    const product = products.find(p => p.id === id);
    if (product) openModal(product);
  }

  function updateStats(filtered) {
    const totalProducts = filtered.length;
    const totalSales = filtered.reduce((sum, p) => sum + p.revenue, 0);
    const totalUnits = filtered.reduce((sum, p) => sum + p.units, 0);
    const totalStock = filtered.reduce((sum, p) => sum + p.stock.full + p.stock.sp + p.stock.masp, 0);

    document.getElementById("totalProducts").textContent = totalProducts;
    document.getElementById("totalSales").textContent = `R$ ${totalSales.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    document.getElementById("totalUnits").textContent = totalUnits;
    document.getElementById("totalStock").textContent = totalStock;
  }

  function showLogin() {
    document.getElementById("loginScreen").style.display = "flex";
    document.getElementById("mainDashboard").style.display = "none";
    document.getElementById("loginError").style.display = "none";
    document.getElementById("username").focus();
  }

  function showDashboard() {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("mainDashboard").style.display = "block";
    renderProducts();
  }

  function logout() {
    sessionStorage.removeItem("isLoggedIn");
    showLogin();
  }

  function checkAuth() {
    const loggedIn = sessionStorage.getItem("isLoggedIn");
    if(loggedIn === "true") {
      showDashboard();
    } else {
      showLogin();
    }
  }

  document.getElementById("loginForm").addEventListener("submit", function(e){
    e.preventDefault();
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if(validCredentials[username] && validCredentials[username] === password){
      sessionStorage.setItem("isLoggedIn", "true");
      document.getElementById("loginError").style.display = "none";
      this.reset();
      showDashboard();
    } else {
      document.getElementById("loginError").style.display = "block";
    }
  });

  document.getElementById("productForm").addEventListener("submit", function(e){
    e.preventDefault();

    const newData = {
      sku: document.getElementById("productSKU").value.trim(),
      name: document.getElementById("productName").value.trim(),
      image: document.getElementById("productImage").value.trim(),
      month: document.getElementById("productMonth").value.toLowerCase(),
      channel: document.getElementById("productChannel").value.toLowerCase(),
      units: parseInt(document.getElementById("productUnits").value,10),
      revenue: parseFloat(document.getElementById("productRevenue").value),
      stock: {
        full: parseInt(document.getElementById("stockFull").value,10),
        sp: parseInt(document.getElementById("stockSP").value,10),
        masp: parseInt(document.getElementById("stockMASP").value,10),
      }
    };

    if(editingProductId !== null){
      // Atualiza produto existente
      const index = products.findIndex(p => p.id === editingProductId);
      if(index !== -1){
        products[index] = {...products[index], ...newData};
      }
    } else {
      // Adiciona novo produto
      products.push({id: Date.now(), ...newData});
    }

    saveData();
    renderProducts();
    closeModal();
  });

  document.getElementById("monthFilter").addEventListener("change", renderProducts);
  document.getElementById("channelFilter").addEventListener("change", renderProducts);
  document.getElementById("skuFilter").addEventListener("input", renderProducts);

  window.addEventListener("click", function(e){
    const modal = document.getElementById("productModal");
    if(e.target === modal){
      closeModal();
    }
  });

  window.addEventListener("load", function(){
    loadData();
    checkAuth();
  });
</script>
</body>
</html>
